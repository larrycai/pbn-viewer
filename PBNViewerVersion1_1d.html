
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head><title>PBN Viewer v1.1.2</title>
<meta http-equiv="Content-Type"  content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Author: Phil Allen Date: Mch 2016 Licence: None
	* you may freely use, modify and distribute this file
	* Limitations of this version:
	* Shows the first {Commentary}
	* Up to 56 bids displayed
  -->
<script language="JavaScript">
<!--
var alertsShown = 0;
var alertsToShowMax = 10;
var pbnText;
var pbnGamesArray = new Array(), pbnGamesArrayPointer;
var pbnGamesArrayToUse;
var pbnGamesTextArray, pbnGamesTextArrayLength;
var pbnTextArray, pbnTextArrayLength
var northCardsArray = new Array(), eastCardsArray = new Array(), southCardsArray = new Array(), westCardsArray = new Array();
var northSpades =  new Array(), northHearts =  new Array(), northDiamonds =  new Array(), northClubs =  new Array();
var pbnBidsDivs = new Array(), pbnBidsDivsPointer;
var pbnPlayDivs = new Array(), pbnPlayDivsPointer;
var northPbnCards = new Array(), eastPbnCards = new Array(), southPbnCards = new Array(), westPbnCards = new Array();
var trickArray = new Array(), trickArrayPointer;
var auctionArray = new Array(), auctionArrayPointer;
var auctionProgressPointer;
var bidAttitudePointer;
var playArray = new Array(), playArrayCounter;
var spades = 0, hearts = 1, diamonds = 2, clubs = 3, notrumps = 4;
var northPlayer = 0, eastPlayer = 1, southPlayer = 2, westPlayer = 3;
var theDealer, theDeclarer, theContract;
var trumps;
var openingLeadPlayer;
var playerOnLead;
var trickNumber, tricksNS, tricksEW;
var trickCardsPlayed;
var playAttitudePointer;
var nextCardToPlayPointer;
var continueScanFrom;
var northAlias,eastAlias,southAlias,westAlias;
var northCards,eastCards,southCards,eastCards;
var startOfHand = 0, endOfHand = 1;
var howManyTricksClaimed;
var theAsciiCodeDigitTwo = "2".charCodeAt(0);
var theAsciiCodeDigitNine = "9".charCodeAt(0);
pbnGamesArray[startOfHand] = new Array();
pbnGamesArray[endOfHand] = new Array();
northPbnCards[spades] = new Array();
northPbnCards[hearts] = new Array();
northPbnCards[diamonds] = new Array();
northPbnCards[clubs] = new Array();
eastPbnCards[spades] = new Array();
eastPbnCards[hearts] = new Array();
eastPbnCards[diamonds] = new Array();
eastPbnCards[clubs] = new Array();
southPbnCards[spades] = new Array();
southPbnCards[hearts] = new Array();
southPbnCards[diamonds] = new Array();
southPbnCards[clubs] = new Array();
westPbnCards[spades] = new Array();
westPbnCards[hearts] = new Array();
westPbnCards[diamonds] = new Array();
westPbnCards[clubs] = new Array();
for(i=0;i<56;i++) {
	pbnBidsDivs[i] = "PbnBid" + (i+1);
}
function pbnReader() {
	//var pbnHandsScanStart = 0;
	var endOfPbnGame = 0;
	pbnGamesArrayPointer = 0;
	trickArrayPointer = 0;
	auctionArrayPointer = 0;
	auctionProgressPointer = 0;
	bidAttitudePointer = 0;
	pbnBidsDivsPointer = 0;
	playArrayCounter = 0;
	theDealer = 0;
	theDeclarer = 0;
	theContract = "";
	trumps = 0;
	openingLeadPlayer = 0;
	playerOnLead = 0;
	trickNumber = 0
	tricksNS = 0
	tricksEW = 0
	trickCardsPlayed = 0;
	playAttitudePointer = 0;
	pbnPlayDivsPointer = 0;
	nextCardToPlayPointer = 0;
	continueScanFrom = 0;
	howManyTricksClaimed = 0;
	trickNumber = 0;
	trickCardsPlayed = 0;
	for(i=0;i<13;i++) {
		northPbnCards[spades][i] = 'X';
		northPbnCards[hearts][i] = 'X';
		northPbnCards[diamonds][i] = 'X';
		northPbnCards[clubs][i] = 'X';
		eastPbnCards[spades][i] = 'X';
		eastPbnCards[hearts][i] = 'X';
		eastPbnCards[diamonds][i] = 'X';
		eastPbnCards[clubs][i] = 'X';
		southPbnCards[spades][i] = 'X';
		southPbnCards[hearts][i] = 'X';
		southPbnCards[diamonds][i] = 'X';
		southPbnCards[clubs][i] = 'X';
		westPbnCards[spades][i] = 'X';
		westPbnCards[hearts][i] = 'X';
		westPbnCards[diamonds][i] = 'X';
		westPbnCards[clubs][i] = 'X';
		northSpades[i] = 'X';
		northHearts[i] = 'X';
		northDiamonds[i] = 'X';
		northClubs[i] = 'X';
		northCardsArray[i] = 0;
		eastCardsArray[i] = 0;
		southCardsArray[i] = 0;
		westCardsArray[i] = 0;
	}
	for(i=0;i<4;i++) {
		pbnPlayDivs[i] = "PbnPlay" + (i+1);
		trickArray[1] = "";
	}
	pbnGamesTextArray = pbnText.split("\n");
	pbnGamesTextArrayLength = pbnGamesTextArray.length;
	for(i=0;i<pbnGamesTextArrayLength;i++) {
		pbnGamesTextArray[i] = pbnGamesTextArray[i].replace(/(\r\n|\n|\r)/gm,"");
	}
	//pbnHandsScanStart = 0;
	for(j=0;j<pbnGamesTextArrayLength;j++) {
		//pbnHandsScanStart = i;
		endOfPbnGame = findEndOfGame(j,pbnGamesTextArray);
		if(endOfPbnGame != -1) {
			pbnGamesArray[startOfHand][pbnGamesArrayPointer] = j;
			pbnGamesArray[endOfHand][pbnGamesArrayPointer] = endOfPbnGame;
			pbnGamesArrayPointer++;
			j = endOfPbnGame;
		}
	}
	pbnGamesArrayToUse = 1;
	pbnParser();
}
function pbnParser() {
	var tempString;
	var tempArray = new Array();
	var tempCounter = 0;
	for (i=pbnGamesArray[startOfHand][pbnGamesArrayToUse-1];i<=pbnGamesArray[endOfHand][pbnGamesArrayToUse-1];i++) {
		tempArray[tempCounter] = pbnGamesTextArray[i];
		tempCounter++;
	}
	pbnTextArray = tempArray;
	auctionProgressPointer = 0;
	theEndOfGame = findEndOfGame(0,pbnTextArray);
	theEndOfGame = pbnTextArray.length;
	document.getElementById("PbnSite").innerHTML = pbnSubstring(7,searchPbnTextArray("Site ",pbnTextArray));
	document.getElementById("PbnEvent").innerHTML = pbnSubstring(8,searchPbnTextArray("Event ",pbnTextArray));
	document.getElementById("PbnDate").innerHTML = formatDate(pbnSubstring(0,searchPbnTextArray("Date ",pbnTextArray)));
	if(pbnGamesArrayPointer === 1) {
			document.getElementById("PbnHandRecords").innerHTML =  "Game " + pbnGamesArrayToUse + " of 1";
	} else {
			document.getElementById("PbnHandRecords").innerHTML =  "Game " + pbnGamesArrayToUse +" of " + pbnGamesArrayPointer;
	}
	document.getElementById("PbnBoardNumber").innerHTML = "Board: " + makeBlue(pbnSubstring(8,searchPbnTextArray("Board ",pbnTextArray)));
	document.getElementById("PbnDealer").innerHTML = "Dealer: " + makeBlue(convertDealer(pbnSubstring(9,searchPbnTextArray("Dealer ",pbnTextArray))));
	document.getElementById("PbnVulnerable").innerHTML = "Vul: " + makeBlue(pbnSubstring(13,searchPbnTextArray("Vulnerable ",pbnTextArray)));
	document.getElementById("PbnScoring").innerHTML = "Scoring: " + makeBlue(convertScoring(pbnSubstring(10,searchPbnTextArray("Scoring ",pbnTextArray))));
	document.getElementById("PbnNorth").innerHTML = pbnSubstring(8,searchPbnTextArray("North ",pbnTextArray));
	document.getElementById("PbnEast").innerHTML = pbnSubstring(7,searchPbnTextArray("East ",pbnTextArray));
	document.getElementById("PbnSouth").innerHTML = pbnSubstring(8,searchPbnTextArray("South ",pbnTextArray));
	document.getElementById("PbnWest").innerHTML = pbnSubstring(7,searchPbnTextArray("West ",pbnTextArray));
	document.getElementById("PbnCommentary").innerHTML = searchPbnTextArrayForAnnotation();
	document.getElementById("PbnDeclarer").innerHTML = "Declarer: " + makeBlue(convertDeclarer(pbnSubstring(11,searchPbnTextArray("Declarer ",pbnTextArray))));
	document.getElementById("PbnTrickNumber").innerHTML = "Tricks Played:";
	document.getElementById("PbntricksNS").innerHTML = "NS Tricks:";
	document.getElementById("PbntricksEW").innerHTML = "EW Tricks:";
	theContract = pbnSubstring(11,searchPbnTextArray("Contract ",pbnTextArray));
	//document.getElementById("PbnContract").innerHTML = theContract;
	document.getElementById("PbnContract").innerHTML = convertContract(theContract);
	document.getElementById("PbnResult").innerHTML = "Result: " + makeBlue(pbnSubstring(9,searchPbnTextArray("Result ",pbnTextArray)));
	trumps = findTrumps(theContract);
	getAuctionFromPbnTextArray();
	if(auctionArrayPointer === 0) {
		alert('No Auction Data Found!');
	}
	tempString = searchPbnTextArray("Deal ",pbnTextArray);
	switch (tempString.substring(7,8)) {
		case 'N':
			northCards = tempString.substring(9,25);
			eastCards = tempString.substring(26,42);
			southCards = tempString.substring(43,59);
			westCards = tempString.substring(60,76);
		break;
		case 'E':
			eastCards = tempString.substring(9,25);
			southCards = tempString.substring(26,42);
			westCards = tempString.substring(43,59);
			northCards = tempString.substring(60,76);
		break;
		case 'S':
			southCards = tempString.substring(9,25);
			westCards = tempString.substring(26,42);
			northCards = tempString.substring(43,59);
			eastCards = tempString.substring(60,76);
		break;
		case 'W':
			westCards = tempString.substring(9,25);
			northCards = tempString.substring(26,42);
			eastCards = tempString.substring(43,59);
			southCards = tempString.substring(60,76);
		break;
	}
	dealCards(northCards,northCardsArray,northPbnCards);
	dealCards(eastCards,eastCardsArray,eastPbnCards);
	dealCards(southCards,southCardsArray,southPbnCards);
	dealCards(westCards,westCardsArray,westPbnCards);
	document.getElementById("PbnNorthSpades").innerHTML = getCardsInHand(northPbnCards[spades]);
	document.getElementById("PbnNorthHearts").innerHTML = getCardsInHand(northPbnCards[hearts]);
	document.getElementById("PbnNorthDiamonds").innerHTML = getCardsInHand(northPbnCards[diamonds]);
	document.getElementById("PbnNorthClubs").innerHTML = getCardsInHand(northPbnCards[clubs]);
	document.getElementById("PbnEastSpades").innerHTML = getCardsInHand(eastPbnCards[spades]);
	document.getElementById("PbnEastHearts").innerHTML = getCardsInHand(eastPbnCards[hearts]);
	document.getElementById("PbnEastDiamonds").innerHTML = getCardsInHand(eastPbnCards[diamonds]);
	document.getElementById("PbnEastClubs").innerHTML = getCardsInHand(eastPbnCards[clubs]);
	document.getElementById("PbnSouthSpades").innerHTML = getCardsInHand(southPbnCards[spades]);
	document.getElementById("PbnSouthHearts").innerHTML = getCardsInHand(southPbnCards[hearts]);
	document.getElementById("PbnSouthDiamonds").innerHTML = getCardsInHand(southPbnCards[diamonds]);
	document.getElementById("PbnSouthClubs").innerHTML = getCardsInHand(southPbnCards[clubs]);
	document.getElementById("PbnWestSpades").innerHTML = getCardsInHand(westPbnCards[spades]);
	document.getElementById("PbnWestHearts").innerHTML = getCardsInHand(westPbnCards[hearts]);
	document.getElementById("PbnWestDiamonds").innerHTML = getCardsInHand(westPbnCards[diamonds]);
	document.getElementById("PbnWestClubs").innerHTML = getCardsInHand(westPbnCards[clubs]);
	getPlayFromPbnTextArray();
	if(playArrayCounter === 0) {
		alert('No Play Data Found!');
	} else {
		setupTrickArray();
	}
	resetCards();
	hideAuction();
	showPbnViewer();
}
function resetCards() {
	nextCardToPlayPointer = 0;
	trickNumber = 0;
	trickCardsPlayed = 0;
	playAttitudePointer = playerOnLead = openingLeadPlayer;
	tricksNS = 0
	tricksEW = 0;
	setupTrickArray();
	document.getElementById("PbnPlayOver").innerHTML = "&nbsp;";
	document.getElementById(pbnPlayDivs[northPlayer]).innerHTML = "&nbsp;";
	document.getElementById(pbnPlayDivs[eastPlayer]).innerHTML =  "&nbsp;";
	document.getElementById(pbnPlayDivs[southPlayer]).innerHTML =  "&nbsp;";
	document.getElementById(pbnPlayDivs[westPlayer]).innerHTML =  "&nbsp;";
	document.getElementById("PbnTrickNumber").innerHTML = "Tricks Played:";
	document.getElementById("PbntricksNS").innerHTML = "NS Tricks:";
	document.getElementById("PbntricksEW").innerHTML = "EW Tricks:";
	dealCards(northCards,northCardsArray,northPbnCards);
	dealCards(eastCards,eastCardsArray,eastPbnCards);
	dealCards(southCards,southCardsArray,southPbnCards);
	dealCards(westCards,westCardsArray,westPbnCards);
	document.getElementById("PbnNorthSpades").innerHTML = getCardsInHand(northPbnCards[spades]);
	document.getElementById("PbnNorthHearts").innerHTML = getCardsInHand(northPbnCards[hearts]);
	document.getElementById("PbnNorthDiamonds").innerHTML = getCardsInHand(northPbnCards[diamonds]);
	document.getElementById("PbnNorthClubs").innerHTML = getCardsInHand(northPbnCards[clubs]);
	document.getElementById("PbnEastSpades").innerHTML = getCardsInHand(eastPbnCards[spades]);
	document.getElementById("PbnEastHearts").innerHTML = getCardsInHand(eastPbnCards[hearts]);
	document.getElementById("PbnEastDiamonds").innerHTML = getCardsInHand(eastPbnCards[diamonds]);
	document.getElementById("PbnEastClubs").innerHTML = getCardsInHand(eastPbnCards[clubs]);
	document.getElementById("PbnSouthSpades").innerHTML = getCardsInHand(southPbnCards[spades]);
	document.getElementById("PbnSouthHearts").innerHTML = getCardsInHand(southPbnCards[hearts]);
	document.getElementById("PbnSouthDiamonds").innerHTML = getCardsInHand(southPbnCards[diamonds]);
	document.getElementById("PbnSouthClubs").innerHTML = getCardsInHand(southPbnCards[clubs]);
	document.getElementById("PbnWestSpades").innerHTML = getCardsInHand(westPbnCards[spades]);
	document.getElementById("PbnWestHearts").innerHTML = getCardsInHand(westPbnCards[hearts]);
	document.getElementById("PbnWestDiamonds").innerHTML = getCardsInHand(westPbnCards[diamonds]);
	document.getElementById("PbnWestClubs").innerHTML = getCardsInHand(westPbnCards[clubs]);
	return;
}
function showAuction() {
	showBidHistory();
	//auctionProgressPointer = auctionArrayPointer + 1;
	return;
}
function hideAuction() {
	hideBidHistory();
	auctionProgressPointer = 0;
	pbnBidsDivsPointer = 0;
	return;
}
function incrementAuctionProgressPointer() {
	if(auctionProgressPointer <= auctionArrayPointer) {
		auctionProgressPointer++;
		showAuctionProgress();
		pbnBidsDivsPointer++;
	}
}
function decrementAuctionProgressPointer() {
	if(auctionProgressPointer > 0) {
		auctionProgressPointer--;
		showAuctionProgress();
		pbnBidsDivsPointer--;
	}
}
function nextHand() {
	if(pbnGamesArrayPointer != 1) {
		pbnGamesArrayToUse++;
		if(pbnGamesArrayToUse > pbnGamesArrayPointer) {
			pbnGamesArrayToUse = pbnGamesArrayPointer;
		} else {
			pbnParser();
			resetCards();
			hideAuction();
		}
	}
	return;
}
function previousHand() {
	if(pbnGamesArrayPointer != 1) {
		pbnGamesArrayToUse--;
		if(pbnGamesArrayToUse < 1 ) {
			pbnGamesArrayToUse = 1;
		} else {
			pbnParser();
			resetCards();
			hideAuction();
		}
	}
	return;
}
function playCard() {
	var declarerTricks = 0;
	var trickWinner = 0;
	var highlightedStart = "";
	var highlightedEnd = "";
	var cardPlayed = "";
	var rawCardPlayed = "";
	if(playArrayCounter == 0) {
		alert('Select a deal first please');
		return;
	}
	if(trickNumber === 13) {
		return;
	}
	if (typeof trickArray[nextCardToPlayPointer] === "undefined" || trickArray[nextCardToPlayPointer] === "PbnPlay") {
    	return;
	}
	
	if(trickCardsPlayed == 0) {
		document.getElementById(pbnPlayDivs[northPlayer]).innerHTML = "&nbsp;";
		document.getElementById(pbnPlayDivs[eastPlayer]).innerHTML = "&nbsp;";
		document.getElementById(pbnPlayDivs[southPlayer]).innerHTML = "&nbsp;";
		document.getElementById(pbnPlayDivs[westPlayer]).innerHTML = "&nbsp;";
		highlightedStart = "<span class='highlightCard'>";
		highlightedEnd = "</span>";
		
	} else {
		highlightedStart = "";
		highlightedEnd = "";
	}
	rawCardPlayed = trickArray[nextCardToPlayPointer];
	cardPlayed = convertCardPlayed(rawCardPlayed);
	switch (playAttitudePointer)
 	{
	case northPlayer:
		document.getElementById(pbnPlayDivs[northPlayer]).innerHTML = highlightedStart + cardPlayed + highlightedEnd;
		break;
	case eastPlayer:
		document.getElementById(pbnPlayDivs[eastPlayer]).innerHTML = highlightedStart + cardPlayed + highlightedEnd;
		break;
	case southPlayer:
		document.getElementById(pbnPlayDivs[southPlayer]).innerHTML = highlightedStart + cardPlayed + highlightedEnd;
		break;
	case westPlayer:
		document.getElementById(pbnPlayDivs[westPlayer]).innerHTML = highlightedStart + cardPlayed + highlightedEnd;
		break;
	}
	removeCardFromHand(playAttitudePointer,rawCardPlayed);
	playAttitudePointer++;
	trickCardsPlayed++;
	nextCardToPlayPointer++;
	if(nextCardToPlayPointer > westPlayer) {
		nextCardToPlayPointer = northPlayer;
	}
	if(playAttitudePointer > westPlayer) {
		playAttitudePointer = northPlayer;
	}
	if(trickCardsPlayed > 3) {
		trickWinner = findTrickWinner();
		switch (trickWinner)
		{
			case 0:
				nextCardToPlayPointer = 0;
				break;
			case 1:
				nextCardToPlayPointer = 1;
				break;
			case 2:
				nextCardToPlayPointer = 2;
				break;
			case 3:
				nextCardToPlayPointer = 3;
				break;
		}
		trickWinner = trickWinner + openingLeadPlayer;
		if(trickWinner > 3) {
			trickWinner = trickWinner - 4;
		}
		playerOnLead = trickArrayPointer = playAttitudePointer = trickWinner;
		if(playerOnLead == northPlayer || playerOnLead == southPlayer) {
			tricksNS++;
		} else {
			tricksEW++;
		}
		trickNumber++;
		setupTrickArray();
		trickCardsPlayed = 0;
	}
	document.getElementById("PbnTrickNumber").innerHTML = "Tricks Played: " + makeBlue(trickNumber);
	document.getElementById("PbntricksNS").innerHTML = "NS Tricks: " + makeBlue(tricksNS);
	document.getElementById("PbntricksEW").innerHTML = "EW Tricks: " + makeBlue(tricksEW);
	if(trickNumber === 13) {
		document.getElementById("PbnPlayOver").innerHTML = makeBlue("End ");
	}
	if (typeof trickArray[nextCardToPlayPointer] === "undefined" || trickArray[nextCardToPlayPointer] === "PbnPlay") {
		document.getElementById("PbnPlayOver").innerHTML = makeBlue("End ");
		if(theDeclarer == northPlayer || theDeclarer === southPlayer) {
			declarerTricks = tricksNS;
		} else {
			declarerTricks = tricksEW;
		}
	}
}
function showBidHistory() {
	var continueScanFrom = 0;
	pbnBidsDivsPointer = theDealer;
	bidAttitudePointer = theDealer;
	auctionProgressPointer = 0;
	bidsShown = 0;
	if(auctionArrayPointer == 0) {
		return;
	}
	for(i=0;i<56;i++) {
		document.getElementById(pbnBidsDivs[i]).innerHTML = '&nbsp;';
	}
	for(i=0;i<=auctionArrayPointer;i++)
	 {
		switch (bidAttitudePointer)
	 	{
		case northPlayer:
			document.getElementById(pbnBidsDivs[pbnBidsDivsPointer]).innerHTML = auctionArray[i];
			bidAttitudePointer++;
			pbnBidsDivsPointer++;
			break;
		case eastPlayer:
			document.getElementById(pbnBidsDivs[pbnBidsDivsPointer]).innerHTML = auctionArray[i];
			bidAttitudePointer++;
			pbnBidsDivsPointer++;
			break;
		case southPlayer:
			document.getElementById(pbnBidsDivs[pbnBidsDivsPointer]).innerHTML = auctionArray[i];
			bidAttitudePointer++;
			pbnBidsDivsPointer++;
			break;
		case westPlayer:
			document.getElementById(pbnBidsDivs[pbnBidsDivsPointer]).innerHTML = auctionArray[i];
			bidAttitudePointer++;
			pbnBidsDivsPointer++;
			break;
		}
		if(bidAttitudePointer > westPlayer) {
			bidAttitudePointer = northPlayer
			continueScanFrom = i + 1;
			i = auctionArrayPointer;
		}
	}
	if(continueScanFrom <= auctionArrayPointer)
	{
		for(i=continueScanFrom;i<= auctionArrayPointer;i++)
		{	
			if(auctionArray[i].charCodeAt(0) == 13) {
			} else {
				document.getElementById(pbnBidsDivs[pbnBidsDivsPointer]).innerHTML = auctionArray[i];
				bidAttitudePointer++;
				pbnBidsDivsPointer++;
				if(bidAttitudePointer > westPlayer) {
					bidAttitudePointer = northPlayer
				}
				if(pbnBidsDivsPointer > 55) {
					i = auctionArrayPointer + 1;
				}
			}
		}
	}
}
function showAuctionProgress() {
	var continueScanFrom = 0;
	bidAttitudePointer = theDealer;
	pbnBidsDivsPointer = theDealer;
	bidsShown = 0;
	if(auctionArrayPointer == 0) {
		return;
	}
	for(i=0;i<56;i++) {
		document.getElementById(pbnBidsDivs[i]).innerHTML = '&nbsp;';
	}
	if(auctionProgressPointer === 0) {
		return;
	}
	for(i=0;i<auctionProgressPointer;i++)
	 {	
		switch (bidAttitudePointer)
	 	{
		case northPlayer:
			document.getElementById(pbnBidsDivs[pbnBidsDivsPointer]).innerHTML = auctionArray[i];
			break;
		case eastPlayer:
			document.getElementById(pbnBidsDivs[pbnBidsDivsPointer]).innerHTML = auctionArray[i];
			break;
		case southPlayer:
			document.getElementById(pbnBidsDivs[pbnBidsDivsPointer]).innerHTML = auctionArray[i];
			break;
		case westPlayer:
			document.getElementById(pbnBidsDivs[pbnBidsDivsPointer]).innerHTML = auctionArray[i];
			break;
		}
		bidAttitudePointer++;
		pbnBidsDivsPointer++;
		bidsShown++;
		if(bidAttitudePointer > westPlayer) {
			bidAttitudePointer = northPlayer
			continueScanFrom = i + 1;
			i = auctionArrayPointer;
		}
	}
	if(continueScanFrom < auctionProgressPointer && bidsShown < auctionProgressPointer)
	{	
		for(i=continueScanFrom;i< auctionProgressPointer;i++)
		{	
			if(auctionArray[i].charCodeAt(0) == 13) {
				// TIDY UP HERE !
			} else {
				document.getElementById(pbnBidsDivs[pbnBidsDivsPointer]).innerHTML = auctionArray[i];
				bidAttitudePointer++;
				pbnBidsDivsPointer++;
				if(bidAttitudePointer > westPlayer) {
					bidAttitudePointer = northPlayer
				}
				if(pbnBidsDivsPointer > 55) {
					i = auctionArrayPointer + 1;
				}
			}
		}
	}
}
function hideBidHistory() {
	if(auctionArrayPointer == 0) {
		return;
	}
	for(i=0;i<56;i++) {
		document.getElementById(pbnBidsDivs[i]).innerHTML = '&nbsp;';
	}
}
function getCardsInHand(PbnCards) {
	var tempString2 = '';
	for(i=0;i<13;i++) {
		tempString = PbnCards[i];
		if(tempString != 'X') {
			tempString2 = tempString2 + tempString;
		}
	}
	return tempString2;
}
function dealCards(pbnCards,theCardsArray,thePbnCards) {
	var theSuit = spades;
	var theSuitPointer = 0;
	var theRank = 0;
	var theCardsArrayPointer;
	theCardsArrayPointer = 0;
	var thePbnCard;
	for(i = 0;i<16;i++) {
		thePbnCard = pbnCards.substring(i,i+1);
		if(thePbnCard === '.') {
			theSuit++;
			theSuitPointer = 0;
		} else {
			theCardsArray[theCardsArrayPointer] = convertPbnCard(theSuit,thePbnCard);
			thePbnCards[theSuit][theSuitPointer] = thePbnCard;
			theSuitPointer++;
			theCardsArrayPointer++;
		}
	}
}
function findCardSuit(theCard) {
	var theSuit = theCard;
	switch (theCard.substring(0,1))
	{
	case "S":
		theSuit = spades;
		break;
	case "H":
		theSuit = hearts;
		break;
	case "D":
		theSuit = diamonds;
		break;
	case "C":
		theSuit = clubs;
		break;
	}
	return theSuit;
}
function findCardRank(theCard) {
	return theCard.substring(1,2);
}
function findCardNumericRank(theCard) {
	var rawRank = findCardRank(theCard);
	switch (rawRank)
	{
	case "A":
		return 14;
	case "K":
		return 13;	
	case "Q":
		return 12;
	case "J":
		return 11;
	case "T":
		return 10;
	default:
		return parseInt(rawRank);
	}
	return -1;
}
function convertPbnCard(theSuit,thePbnCard) {
	var theAsciiCode;
	theAsciiCode = thePbnCard.charCodeAt(0);
   	if(theAsciiCode <= theAsciiCodeDigitNine) {
   		return (theSuit * 13) + theAsciiCode - theAsciiCodeDigitTwo;
   	}
   	if(thePbnCard == 'T') {
   		return (theSuit * 13) + 8;
   	}
   	if(thePbnCard == 'J') {
   		return (theSuit * 13) + 9;
   	}
   	if(thePbnCard == 'Q') {
   		return (theSuit * 13) + 10;
   	}
   	if(thePbnCard == 'K') {
   		return (theSuit * 13) + 11;
   	}
   	if(thePbnCard == 'A') {
   		return (theSuit * 13) + 12;
   	}
    return -1;
}
function removeCardFromHand(playAttitudePointer,rawCardPlayed) {
	var theSuit = rawCardPlayed.substring(0,1);
	var theRank =  rawCardPlayed.substring(1,2);
	var theHand = "";
	switch (playAttitudePointer)
	{
	case northPlayer:
		switch (theSuit)
		{
			case "S":
				theHand = northPbnCards[spades];
				for(i=0;i<13;i++) {
					if(theHand[i] == theRank) {
						theHand[i] = "X";
					}
				}
				document.getElementById("PbnNorthSpades").innerHTML = getCardsInHand(northPbnCards[spades]);
			break;
			case "H":
				theHand = northPbnCards[hearts];
				for(i=0;i<13;i++) {
					if(theHand[i] == theRank) {
						theHand[i] = "X";
					}
				}
				document.getElementById("PbnNorthHearts").innerHTML = getCardsInHand(northPbnCards[hearts]);
			break;
			case "D":
				theHand = northPbnCards[diamonds];
				for(i=0;i<13;i++) {
					if(theHand[i] == theRank) {
						theHand[i] = "X";
					}
				}
				document.getElementById("PbnNorthDiamonds").innerHTML = getCardsInHand(northPbnCards[diamonds]);
			break;
			case "C":
				theHand = northPbnCards[clubs];
				for(i=0;i<13;i++) {
					if(theHand[i] == theRank) {
						theHand[i] = "X";
					}
				}
				document.getElementById("PbnNorthClubs").innerHTML = getCardsInHand(northPbnCards[clubs]);
			break;
		}
		break;
	case eastPlayer:
		switch (theSuit)
		{
			case "S":
				theHand = eastPbnCards[spades];
				for(i=0;i<13;i++) {
					if(theHand[i] == theRank) {
						theHand[i] = "X";
					}
				}
				document.getElementById("PbnEastSpades").innerHTML = getCardsInHand(eastPbnCards[spades]);
			break;
			case "H":
				theHand = eastPbnCards[hearts];
				for(i=0;i<13;i++) {
					if(theHand[i] == theRank) {
						theHand[i] = "X";
					}
				}
				document.getElementById("PbnEastHearts").innerHTML = getCardsInHand(eastPbnCards[hearts]);
			break;
			case "D":
				theHand = eastPbnCards[diamonds];
				for(i=0;i<13;i++) {
					if(theHand[i] == theRank) {
						theHand[i] = "X";
					}
				}
				document.getElementById("PbnEastDiamonds").innerHTML = getCardsInHand(eastPbnCards[diamonds]);
			break;
			case "C":
				theHand = eastPbnCards[clubs];
				for(i=0;i<13;i++) {
					if(theHand[i] == theRank) {
						theHand[i] = "X";
					}
				}
				document.getElementById("PbnEastClubs").innerHTML = getCardsInHand(eastPbnCards[clubs]);
			break;
		}
		break;
	case southPlayer:
		switch (theSuit)
		{
			case "S":
				theHand = southPbnCards[spades];
				for(i=0;i<13;i++) {
					if(theHand[i] == theRank) {
						theHand[i] = "X";
					}
				}
				document.getElementById("PbnSouthSpades").innerHTML = getCardsInHand(southPbnCards[spades]);
			break;
			case "H":
				theHand = southPbnCards[hearts];
				for(i=0;i<13;i++) {
					if(theHand[i] == theRank) {
						theHand[i] = "X";
					}
				}
				document.getElementById("PbnSouthHearts").innerHTML = getCardsInHand(southPbnCards[hearts]);
			break;
			case "D":
				theHand = southPbnCards[diamonds];
				for(i=0;i<13;i++) {
					if(theHand[i] == theRank) {
						theHand[i] = "X";
					}
				}
				document.getElementById("PbnSouthDiamonds").innerHTML = getCardsInHand(southPbnCards[diamonds]);
			break;
			case "C":
				theHand = southPbnCards[clubs];
				for(i=0;i<13;i++) {
					if(theHand[i] == theRank) {
						theHand[i] = "X";
					}
				}
				document.getElementById("PbnSouthClubs").innerHTML = getCardsInHand(southPbnCards[clubs]);
			break;
		}
		break;
	case westPlayer:
		switch (theSuit)
		{
			case "S":
				theHand = westPbnCards[spades];
				for(i=0;i<13;i++) {
					if(theHand[i] == theRank) {
						theHand[i] = "X";
					}
				}
				document.getElementById("PbnWestSpades").innerHTML = getCardsInHand(westPbnCards[spades]);
			break;
			case "H":
				theHand = westPbnCards[hearts];
				for(i=0;i<13;i++) {
					if(theHand[i] == theRank) {
						theHand[i] = "X";
					}
				}
				document.getElementById("PbnWestHearts").innerHTML = getCardsInHand(westPbnCards[hearts]);
			break;
			case "D":
				theHand = westPbnCards[diamonds];
				for(i=0;i<13;i++) {
					if(theHand[i] == theRank) {
						theHand[i] = "X";
					}
				}
				document.getElementById("PbnWestDiamonds").innerHTML = getCardsInHand(westPbnCards[diamonds]);
			break;
			case "C":
				theHand = westPbnCards[clubs];
				for(i=0;i<13;i++) {
					if(theHand[i] == theRank) {
						theHand[i] = "X";
					}
				}
				document.getElementById("PbnWestClubs").innerHTML = getCardsInHand(westPbnCards[clubs]);
			break;
		}
		break;
	}
	return;
}
function searchPbnTextArrayForAnnotation() {
	var tempString = "";
	var theClaimAnnotation = "";
	var annotationFound = false;
	var searchPosition;
	howManyTricksClaimed = 0;
	for(x=0;x<pbnTextArray.length;x++)
	{
		for(i=0;i<pbnTextArray[x].length;i++)
		{	
			tempString = pbnTextArray[x].substring(i,i+1);
			if(annotationFound == true)
			{	
				if (tempString === "}")
				{
					if(theClaimAnnotation.substring(2,9) === "claimed")
					{
						howManyTricksClaimed = parseInt(theClaimAnnotation.substring(10,12));
						return theClaimAnnotation;
					} 
					else
					{
						theClaimAnnotation ="";
					}
					annotationFound = false;
				}
				else
				{
					theClaimAnnotation = theClaimAnnotation + tempString;
				}
			}
			else
			{
				if (tempString === "{")
				{
					annotationFound = true;
				}
			}
		}
	}
	return theClaimAnnotation;
}
function findEndOfGame(startpoint,pbnTextArray) {
	var startOfHand = -1;
	var firstCharacter = "";
	var lastCharacter = "";
	var theCharacter = "";
	var thePreviousCharacter = "";
	var annotationFound = false;
	for(x=startpoint;x<pbnTextArray.length;x++)
	{
		if(pbnTextArray[x].length === 1)
		{
			return -1;
		}
		
		firstCharacter = pbnTextArray[x].substring(0,1);
		lastCharacter = pbnTextArray[x].substring(pbnTextArray[x].length -1,pbnTextArray[x].length);
		// Annotation could come first ...
		if(annotationFound === true)
		{
			if(lastCharacter === "}")
			{
				annotationFound = false;
			}
		}
		else if(firstCharacter === "{")
		{
			annotationFound = true;
		}
		else if(firstCharacter === "[")
		{
			startOfHand = x;
			break;
		}
	}
	if(startOfHand === -1) {
		return startOfHand;
	}
	for(x=startOfHand;x<pbnTextArray.length;x++)
	{
		for(i=0;i<(pbnTextArray[x].length);i++)
		{
			theCharacter = pbnTextArray[x].substring(i,i+1);
			if(i === 0) {
				thePreviousCharacter = "START";
			}
			else
			{
				thePreviousCharacter = pbnTextArray[x].substring(i-1,i);
			}
			
			if(annotationFound === true)
			{
				if(theCharacter === "}") {
					annotationFound = false;
				}
			}
			else if(theCharacter === "{")
			{
				annotationFound = true;
			}
			else
			{
				if(pbnTextArray[x].length === 1 || (theCharacter === " "  && thePreviousCharacter === "START" && pbnTextArray[x].length === 1))
				{
					return x;
				}
			}
		}
	}
	return x - 1;
}
function searchPbnTextArray(searchFor,pbnTextArray) {
	for(x=0;x<theEndOfGame;x++)
	{
		var searchPosition = pbnTextArray[x].search(searchFor);
		if(searchPosition === 1)
		{
			return pbnTextArray[x];
		}
	}
	return "";
}
function getAuctionFromPbnTextArray() {
	var auctionPointer = 0;
	var auctionFound = false;
	var searchPosition = 0;
	var tempString = "";
	var tempString2 = "";
	//var auctionString = "";
	var theAlertString = "";
	var alertedBidFound = false;
	var annotationFound = false;
	var theAnnotationString = "";
	
	auctionArrayPointer = 0;
	for(x=0;x<theEndOfGame;x++)
	{
		if(auctionFound === false) {
			searchPosition = pbnTextArray[x].search('Auction "');
			if(searchPosition >= 1)
			{
				auctionFound = true;
			}
		} else
		{
			tempString = pbnTextArray[x].substring(0,1);
			if(tempString === '[' || tempString === '*' || tempString === null)
			{
				x = theEndOfGame; // Break out of the loop
			} else 
			{
				for(i=0;i<pbnTextArray[x].length;i++)
				{
					tempString = pbnTextArray[x].substring(i,i + 1);
					if(alertedBidFound == true)
					{
						if(tempString === "=") {
							theAlertString = theAlertString + "=";
							tempString = "";
							tempString2 = "";
							alertedBidFound = false;
							theAlertString = "";
							auctionArray[auctionArrayPointer - 1] = auctionArray[auctionArrayPointer - 1] + "!";
						}
						else
						{
							theAlertString = theAlertString + tempString;
						}
					}
					else if(annotationFound === true)
					{
						if(tempString === "}") {

							tempString = "";
							tempString2 = "";
							annotationFound = false;
							theAnnotationString = "";
						}
						else
						{
							theAnnotationString = theAnnotationString + tempString;
						}

					}
					else
					{
						// Normal
						if(tempString === "=") {
							if(tempString2 != "") {
								auctionArray[auctionArrayPointer] = showSuitSymbols(tempString2);
								auctionArrayPointer++;
							}
							alertedBidFound = true;
							theAlertString = "=";
							tempString = "";
							tempString2 = "";
						} else if(tempString === "{")
						{
							annotationFound = true;
							if(tempString2 != "") {
							auctionArray[auctionArrayPointer] = showSuitSymbols(tempString2);
							auctionArrayPointer++;
							theAnnotationString = "";
							tempString = "";
							tempString2 = "";
						}
						} else
						{
							if(tempString === " " && tempString2 != "")
							{
								auctionArray[auctionArrayPointer] = showSuitSymbols(tempString2);
								tempString = "";
								tempString2 = "";
								theAlertString = "";
								auctionArrayPointer++;
							}
							 else
							{
								if(tempString != " ") 
								{
									tempString2 = tempString2 + tempString;								
								}
							}
						}
					}
				}
				if(tempString != "" && tempString2 != "") {
					auctionArray[auctionArrayPointer] = showSuitSymbols(tempString2);
					tempString = "";
					tempString2 = "";
					auctionArrayPointer++;
					alertedBidFound = false;
					alertedBidEnd = false;
					theAlertString = "=";
				}
			}
		}
	}
	if(tempString != "" && tempString2 != "") {
		auctionArray[auctionArrayPointer] = showSuitSymbols(tempString2);
		auctionArrayPointer++;
	}
	auctionArrayPointer--;
}
function getPlayFromPbnTextArray() {
	var playPointer = 0;
	var playFound = false;
	var playsFound = 0;
	var searchPosition = 0;
	var tempString = "";
	var tempString2 = "";
	var annotationFound = false;
	var theAnnotationString = "";
	playArray.length = 0 ; 
	playArrayCounter = 0;
	for(x=0;x<theEndOfGame;x++)
	{
		if(playFound === false) {
			searchPosition = pbnTextArray[x].search('Play "');
			if(searchPosition >= 1)
			{
				playFound = true;
			}
		} else
		{
			tempString = pbnTextArray[x].substring(0,1);
			if(tempString === '[' || tempString === '*' || tempString === null || tempString === '-')
			{
				x = theEndOfGame;
			}
			else
			{
				tempString = "";
				for(i=0;i<pbnTextArray[x].length;i++)
				{
					tempString = pbnTextArray[x].substring(i,i + 1);
					
					if(annotationFound === true)
					{
						if(tempString === "}")
						 {
							tempString = "";
							tempString2 = "";
							annotationFound = false;
							theAnnotationString = "";
						}
						else
						{
							theAnnotationString = theAnnotationString + tempString;
						}
					}
					else
					{
						if(tempString === "{") {
							annotationFound = true;
							if(tempString === " " && tempString2 != "") {
								playArray[playArrayCounter] = tempString2;
								tempString = "";
								tempString2 = "";
								playArrayCounter++;
								theAnnotationString = "";
								tempString = "";
								tempString2 = "";
							} 
						}
						else
						{
							if(tempString === " " && tempString2 != "") {
								playArray[playArrayCounter] = tempString2;
								tempString = "";
								tempString2 = "";
								playArrayCounter++;
							} else {
								if(tempString == '-')
								{
									tempString2 = "";
									tempString = "";
									break;
						
								} else {
									if(tempString != " ") 
									{
										tempString2 = tempString2 + tempString;
									}
								}
							}
						}
					}
				}
				if(tempString != "" && tempString2 != "") {
					playArray[playArrayCounter] = tempString2;
					tempString = "";
					tempString2 = "";
					playArrayCounter++;
				}
			}
		}
	}
	if(tempString != "" && tempString2 != "" && tempString2 != '-') {
		playArray[playArrayCounter] = (tempString2);
		playArrayCounter++;
	}
	playArrayCounter--;
}
function showSuitSymbols(theString) {
	var tempString2 = "";
	var alertedString = "";
	if(theString == "X") {
		return "<font color=red>X</font>";
	}
	if(theString == "XX") {
		return "<font color=blue>XX</font>";
	}
	if(theString == "Pass") {
		return "<font color=green>Pass</font>";
	}
	if(theString.length == 4 &&  theString.substring(0, 2) == "Pass") {
		return "<font color=green>Pass</font>";
	}
	
	if(theString.length === 3 && theString.substring(2, 3) == "!") {
		alertedString = "<font color=blue>!</font>"
	}
	if(theString.length > 1) {
		tempString2 = theString.substring(1,2);
		if(tempString2 == "S") {
			tempString2 = theString.substring(0,1) +  "&spades;" + alertedString;
		} else if(tempString2 == "H") {
			tempString2 = theString.substring(0,1) + "<font color=red>&hearts;</font>" + alertedString;
		} else if(tempString2 == "D") {
			tempString2 = theString.substring(0,1) +  "<font color=orange>&diams;</font>" + alertedString;
		} else if(tempString2 == "C") {
			tempString2 = theString.substring(0,1) +  "<font color=grey>&clubs;</font>" + alertedString;
		} else if(tempString2 == "N") {
			tempString2 = theString.substring(0,1) + "NT" + alertedString;
		}
	}
	return tempString2;
}
function convertCardPlayed(theCard) {
	var convertedCard = theCard;
	switch (findCardSuit(theCard))
		{
		case spades:
			convertedCard = "&spades;" + theCard.substring(1,2);
			break;
		case hearts:
			convertedCard = "<span class='red'>&hearts;</span>" + theCard.substring(1,2);
			break;
		case diamonds:
			convertedCard = "<span class='red'>&diams;</span>" + theCard.substring(1,2);
			break;
		case clubs:
			convertedCard = "&clubs;" + theCard.substring(1,2);
			break;
		}
	return convertedCard;
}
function convertContract(theContract) {
	var theSuit = "";
	var theRank = theContract.substring(0,1);
	var doubled = theContract.substring(theContract.length - 2,theContract.length);
	if(doubled === "XX") {
		doubled = "<span class='blue'>XX</span>";
	} else if(doubled.substring(1,2) === "X") {
		doubled = "<span class='red'>X</span>";
	} else {
		doubled = "";
	}
	switch (findTrumps(theContract))
		{
		case spades:
			theSuit = "<span class='black'>" + theRank + "&spades;</span>";
			break;
		case hearts:
			theSuit = "<span class='black'>"  + theRank + "</span><span class='red'>&hearts;</span>";
			break;
		case diamonds:
			theSuit = "<span class='black'>"  + theRank + "</span><span class='red'>&diams;</span>";
			break;
		case clubs:
			theSuit = "<span class='black'>"  + theRank + "</span><span class='gray'>&clubs;</span>";
			break;
		case notrumps:
			theSuit = "<span class='black'>" + theRank + "NT</span>";
			break;
		default:
			theSuit = "<span class='black'>" + theContract + "</span>";
		}
		theSuit = theSuit + doubled;
	return "Contract: " + theSuit;
}
function pbnSubstring(start,theString) {
	if(theString === "") {
		return theString;
	}
	var tempString = theString.substring(start,theString.length - 2);
	if(tempString === 'BridgeClubLive!') {
		tempString = 'BridgeClubLive'
	}
	return tempString;
}
function formatDate(theDate) {
	if(theDate === "")
	{
		return "";
	}
	var monthNames = ["January", "February", "March", "April", "May", "June",
  "July", "August", "September", "October", "November", "December"];
	var theMonth = monthNames[parseInt(theDate.substring(12,14)) -1];
	var theDay = theDate.substring(15,17);
	var theYear = theDate.substring(7,11);
	return theMonth + " " + theDay + " " + theYear;
}
function makeBlue(thetext) {
	return "<span class='blue'>" + thetext + "</span>";
}
function convertDeclarer(theDeclarer) {
	var tempString = "Error";
	switch (theDeclarer)
	 	{
		case "N":
			tempString = "North";
			theDeclarer = northPlayer;
			openingLeadPlayer = playerOnLead = playAttitudePointer = pbnPlayDivsPointer = eastPlayer;
			break;
		case "E":
			tempString = "East";
			theDeclarer = eastPlayer;
			openingLeadPlayer = playerOnLead = playAttitudePointer = pbnPlayDivsPointer = southPlayer;
			break
		case "S":
			tempString = "South";
			theDeclarer = southPlayer;
			openingLeadPlayer = playerOnLead = playAttitudePointer = pbnPlayDivsPointer = westPlayer;
			break;
		case "W":
			tempString = "West";
			theDeclarer = westPlayer;
			openingLeadPlayer = playerOnLead = playAttitudePointer  = pbnPlayDivsPointer = northPlayer;
			break;
		}
		trickArrayPointer = 0; // Will always be 0 the first trick
	return tempString
}
function convertDealer(dealer) {
	var tempString = "Error";
	switch (dealer)
	 	{
		case "N":
			tempString = "North";
			theDealer = northPlayer;
			break;
		case "E":
			tempString = "East";
			theDealer = eastPlayer;
			break
		case "S":
			tempString = "South";
			theDealer = southPlayer;
			break;
		case "W":
			tempString = "West";
			theDealer = westPlayer;
			break;
		}
		bidAttitudePointer = theDealer;
		pbnBidsDivsPointer = theDealer;
		auctionProgressPointer = 0;
		bidsShown = 0;
	return tempString
}
function convertScoring(theScoring) {
	if(theScoring === "") {
		return "&nbsp;";
	} else {
		return theScoring + "S";
	}
}
function findTrumps(theContract) {
	var theTrumps = notrumps;
	switch (theContract.substring(1,2))
	{
		case "S":
			return spades;
		case "H":
			return hearts;
		case "D":
			return diamonds;
		case "C":
			return clubs;
	}
	return theTrumps;
}
function setupTrickArray() {
	var counter = 0;
	for(i=trickNumber*4;i<trickNumber*4 + 4 ;i++) {
		trickArray[counter] = playArray[i];
		counter++;
	}
}
function findTrickWinner() {
	var cardsPlayed = new Array();
	var cardsPlayedArrayPointer;
	var leadSuit;
	var leadNumericRank;
	var trickWinner;
	var trickWinnerSuit;
	var trickWinnerNumericRank;
	var cardPlayedSuit;
	var cardPlayedNumericRank;
	for(i=0;i<4;i++) {
		cardsPlayed[i]  = trickArray[i];
		cardsPlayedArrayPointer++;
	}
	switch (openingLeadPlayer)
	{
	case northPlayer:
		switch (playerOnLead)
		{
		case northPlayer:
			cardsPlayedArrayPointer = 0;
			break;
		case eastPlayer:
			cardsPlayedArrayPointer = 1;
			break;
		case southPlayer:
			cardsPlayedArrayPointer = 2;
			break;
		case westPlayer:
			cardsPlayedArrayPointer = 3;
			break;
		}
		break;
	case eastPlayer:
		switch (playerOnLead)
		{
		case northPlayer:
			cardsPlayedArrayPointer = 3;
			break;
		case eastPlayer:
			cardsPlayedArrayPointer = 0;
			break;
		case southPlayer:
			cardsPlayedArrayPointer = 1;
			break;
		case westPlayer:
			cardsPlayedArrayPointer = 2;
			break;
		}
		break;
	case southPlayer:
		switch (playerOnLead)
		{
		case northPlayer:
			cardsPlayedArrayPointer = 2;
			break;
		case eastPlayer:
			cardsPlayedArrayPointer = 3;
			break;
		case southPlayer:
			cardsPlayedArrayPointer = 0;
			break;
		case westPlayer:
			cardsPlayedArrayPointer = 1;
			break;
		}
		break;
	case westPlayer:
		switch (playerOnLead)
		{
		case northPlayer:
			cardsPlayedArrayPointer = 1;
			break;
		case eastPlayer:
			cardsPlayedArrayPointer = 2;
			break;
		case southPlayer:
			cardsPlayedArrayPointer = 3;
			break;
		case westPlayer:
			cardsPlayedArrayPointer = 0;
			break;
		}
		break;
	}
	leadSuit = trickWinnerSuit = findCardSuit(cardsPlayed[cardsPlayedArrayPointer]);
	leadNumericRank = trickWinnerNumericRank = findCardNumericRank(cardsPlayed[cardsPlayedArrayPointer]);
	trickWinner = 0;
	for(i=0;i<4;i++)
	 {
		cardPlayedSuit = findCardSuit(cardsPlayed[cardsPlayedArrayPointer]);
		cardPlayedNumericRank = findCardNumericRank(cardsPlayed[cardsPlayedArrayPointer]);
		if(trumps === notrumps)
		{
			if(cardPlayedSuit === leadSuit)
			{
				if(cardPlayedNumericRank >= trickWinnerNumericRank)
				{
					trickWinner = cardsPlayedArrayPointer;
					trickWinnerSuit = cardPlayedSuit;
					trickWinnerNumericRank = cardPlayedNumericRank;
				}
			}
		}
		else
		{
			if(cardPlayedSuit === trumps)
			{
				if(trickWinnerSuit === trumps && cardPlayedNumericRank >= trickWinnerNumericRank)
				{
					trickWinner = cardsPlayedArrayPointer;
					trickWinnerSuit = cardPlayedSuit;
					trickWinnerNumericRank = cardPlayedNumericRank;
				}
				else
				{
					if (trickWinnerSuit != trumps)
					{
						trickWinner = cardsPlayedArrayPointer;
						trickWinnerSuit = cardPlayedSuit;
						trickWinnerNumericRank = cardPlayedNumericRank;
					}
				}
			} 
			else
			{
				if(cardPlayedSuit === leadSuit && trickWinnerSuit === leadSuit)
				{
					if(cardPlayedNumericRank >= trickWinnerNumericRank)
					{
						trickWinner = cardsPlayedArrayPointer;
						trickWinnerSuit = cardPlayedSuit;
						trickWinnerNumericRank = cardPlayedNumericRank;
					}
				}
			}
		}
		cardsPlayedArrayPointer ++;
		if(cardsPlayedArrayPointer > westPlayer) {
			cardsPlayedArrayPointer = northPlayer;
		}
	}
	return trickWinner;
}
function showPbnViewer() {
	document.getElementById("pbnViewer").style.display = "block";
	document.getElementById("pbnViewerHeader").style.display = "block";
}
//--></script>

<style type="text/css">
body {
	border:0;
}
#header1 {
	width:100%;
}
#header2 {
	width:100%;
}
@media all and (orientation:portrait)
{
  #box1wrap {
	float:left;
	width:auto;
	//margin-top:0px;
    //border: 1px solid #73AD21;  
	}
	#box1 {
		float:left;
		width:auto;
		height:auto;
		background:#ffffff;
	}
	#box1pad {
		position:relative;
		right:0px;
		float:left;
		width:auto;
		overflow:hidden;
	}
	#box2wrap {
		float:left;
		width:auto;
		//margin-top:0px;
		//margin-left:2vw;
		//border: 1px solid #73AD21;  
	}
	#box2 {
		float:left;
		width:auto;
		height:auto;
		background:#ffffff;
		//padding-bottom:5px;
	}
	#box2pad {
		float:left;
		width:auto;
		position:relative;
		right:0px;
		overflow:hidden;
	}
}
 

@media all and (orientation:landscape)
{
  #box1wrap {
	float:left;
	width:auto;
	//margin-top:0px;
    //border: 1px solid #73AD21;  
	}
	#box1 {
		float:left;
		width:auto;
		height:auto;
		background:#ffffff;
	}
	#box1pad {
		position:relative;
		right:0px;
		float:left;
		width:auto;
		overflow:hidden;
	}
	#box2wrap {
		float:left;
		width:auto;
		//margin-top:0px;
		//margin-left:2vw;
		//border: 1px solid #73AD21;  
	}
	#box2 {
		float:left;
		width:auto;
		height:auto;
		background:#ffffff;
		//padding-bottom:5px;
	}
	#box2pad {
		float:left;
		width:auto;
		position:relative;
		right:0px;
		overflow:hidden;
	}
}

#wrapper {
	clear:left;
	float:left;
	width:100%;
	background:#ffffff;
	//padding-bottom:20px;
}


div {
 	display: inline;
 	font-weight: bold;
}
span {
 	display: inline;
 	font-weight: bold;
}
span.red {
	color: red;
}
span.black {
	color: black;
}
span.blue {
	color: blue;
}
span.gray {
	color: gray;
}
span.white {
	color: white;
}
div.red {
	color: red;
}
div.green {
	color: green;
}
div.blue {
	color: blue;
}
div.black {
	color: black;
}
.aligntextright {
	text-align: right;
}
.aligntextcenter {
	text-align: center;
}
.minwidth {
	min-width: 3vw;
}
.minWidthAuction {
	min-width: 3vw;
}
.margins {
    margin-top: 0px;
    margin-bottom: 0px;
    margin-right: 0px;
    margin-left: 0px;
}
.highlightCard {
	border-style: solid;
	border-color: LightGrey;
	border-width: 1px;
	padding: 2px 5px 2px 5px;
}
input[type=button] {

	border: 1px solid #000000;
	background: #ffffff;
	font-size: 1.5vw;
	font-weight: bold;
	//color: #ccc;
	//padding: 0 20px;
	height: auto;
	vertical-align: middle;

    //color:#08233e;
    //font:1vw Futura, ‘Century Gothic’, AppleGothic, sans-serif;
    width:auto;
    /* ... other rules ... */
    //cursor:pointer;
}

input[type=button]:hover {
    background-color:lightgrey;
}
</style>

<style type="text/css">
.rTable {
	display: table;
	width: 100%;
}
.rTableBorder {
	display: table;
	width: 99%;
	border: 1px solid #999999;
}
.rTableBorderHidden {
	display: table;
	width: 99%;
}
.rTableRow {
		display: table-row;
}
.rTableHeading {
		display: table-header-group;
		background-color: #ddd;
}
.rTableCell, .rTableHead {
		display: table-cell;
		padding: 3px 10px;
		height: 20px;
}
.rTableCellBorder, .rTableHead {
		display: table-cell;
		padding: 3px 10px;
		height: 20px;
		border: 1px solid #999999;
}
.rTableHeading {
		display: table-header-group;
		background-color: #ddd;
		font-weight: bold;
}
.rTableFoot {
		display: table-footer-group;
		font-weight: bold;
		background-color: #ddd;
}
.rTableBody {
		display: table-row-group;
}
</style>
</head>
<body>
<div id="header1">
	<div class="blue">PBN Viewer v1.1</div>&nbsp;<input type="file" id="files" name="files[]">
</div>
<div id="header2">
	<div id="pbnViewerHeader" style="display:none;"><div>Site:&nbsp;</div><div id="PbnSite"  class="blue"></div><div>&nbsp;Event:&nbsp;</div><div id="PbnEvent" class="blue"></div><div>&nbsp;Date:&nbsp;</div><div id="PbnDate" class="blue"></div></div>
</div>
<script language="JavaScript">
<!--
	if (window.File && window.FileReader && window.FileList && window.Blob) {
  		// All the File APIs are supported.
  	}	else {
  		alert('The File APIs are not fully supported in this browser.');
	}
	function handleFileSelect(evt) {
    	var files = evt.target.files;
    	f = files[0];
    	var fileExtension = f.name.substr(f.name.length - 4);
		if(fileExtension.toUpperCase() === '.PBN')
    	{
       		var reader = new FileReader();
    		reader.onload = function(e) {
 				pbnText = reader.result;
				pbnReader();
			}
    		reader.readAsText(f);
    	}	else {
    		alert(f.name + ' is not a .pbn file');
    	}
  	}
	document.getElementById('files').addEventListener('change', handleFileSelect, false);
//--></script>

<div id="wrapper">
<div id="pbnViewer" class="margins" style="display:none;">
	

	<div id="box1wrap">
		<div id="box1">
			<div id="box1pad">
	<div class="rTableBorder">
		<div class="rTableBody">
			<div class="rTableRow">
				<div class="rTableCell">
					<div class="rTableBorderHidden">
						<div class="rTableBody">
							<div class="rTableRow">
								<div class="rTableCell"><div id="PbnBoardNumber"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell"><div id="PbnVulnerable"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell"><div id="PbnDealer"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell"><div id="PbnScoring"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell">&nbsp;</div>
							</div>
						</div>
					</div>
					<div class="rTableBorder">
						<div class="rTableBody">
							<div class="rTableRow">
								<div class="rTableCell">&spades;&nbsp;<div id="PbnWestSpades"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell"><span class="red">&hearts;&nbsp;</span><div id="PbnWestHearts"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell"><span class="red">&diams;&nbsp;</span><div id="PbnWestDiamonds"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell">&clubs;&nbsp;<div id="PbnWestClubs"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell aligntextcenter"><div id="PbnWest" class="blue"></div></div>
							</div>
						</div>
					</div>
					<div class="rTableBorderHidden">
						<div class="rTableBody">
							<div class="rTableRow">
								<div class="rTableCell"><span class = "white">TRICKSPLAYED</span></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell">&nbsp;</div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell">&nbsp;</div>
							</div>							
							<div class="rTableRow">
								<div class="rTableCell">&nbsp;</div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell">&nbsp;</div>
							</div>							
						</div>
					</div>
				</div>					
				<div class="rTableCell">
					<div class="rTableBorder">
						<div class="rTableBody">
							<div class="rTableRow">
								<div class="rTableCell">&spades;&nbsp;<div id="PbnNorthSpades"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell">
									<div><span class="red">&hearts;&nbsp;</span><div id="PbnNorthHearts"></div></div>
								</div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell">
									<div><span class="red">&diams;&nbsp;</span><div id="PbnNorthDiamonds"></div></div>
								</div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell">&clubs;&nbsp;<div id="PbnNorthClubs"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell aligntextcenter"><div id="PbnNorth" class="blue"></div></div>
							</div>
						</div>
					</div>
					<div class="rTableBorderHidden">
						<div class="rTableBody">
							<div class="rTableRow">
								<div class="rTableCell aligntextcenter minwidth">&nbsp;</div>
								<div class="rTableCell aligntextcenter minwidth"><div id="PbnPlay1">&nbsp;</div></div>
								<div class="rTableCell aligntextcenter minwidth">&nbsp;</div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell aligntextcenter minwidth"><span class = "white">WWW</span></div>
								<div class="rTableCell aligntextcenter minwidth"><span class = "white">WWW</span></div>
								<div class="rTableCell aligntextcenter minwidth"><span class = "white">WWW</span></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell minwidth"><div id="PbnPlay4">&nbsp;</div></div>
								<div class="rTableCell aligntextcenter minwidth">&nbsp;</div>
								<div class="rTableCell aligntextright minwidth"><div id="PbnPlay2">&nbsp;</div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell aligntextcenter minwidth">&nbsp;</div>
								<div class="rTableCell aligntextcenter minwidth">&nbsp;</div>
								<div class="rTableCell aligntextcenter minwidth">&nbsp;</div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell aligntextcenter minwidth">&nbsp;</div>
								<div class="rTableCell aligntextcenter minwidth"><div id="PbnPlay3">&nbsp;</div></div>
								<div class="rTableCell aligntextcenter minwidth">&nbsp;</div>
							</div>
						</div>
					</div>
					<div class="rTableBorder">
						<div class="rTableBody">
							<div class="rTableRow">
								<div class="rTableCell">&spades;&nbsp;<div id="PbnSouthSpades"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell">
									<div><span class="red">&hearts;&nbsp;</span><div id="PbnSouthHearts"></div></div>
								</div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell">
									<div><span class="red">&diams;&nbsp;</span><div id="PbnSouthDiamonds"></div></div>
								</div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell">&clubs;&nbsp;<div id="PbnSouthClubs"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell aligntextcenter"><div id="PbnSouth" class="blue"></div></div>
							</div>
						</div>
					</div>
				</div>
				<div class="rTableCell">
					<div class="rTableBorderHidden">
						<div class="rTableBody">
							<div class="rTableRow">
								<div class="rTableCell"><div id="PbnContract"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell"><div id="PbnDeclarer"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell"><div id="PbnResult"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell">&nbsp;</div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell">&nbsp;</div>
							</div>
						</div>
					</div>
					<div class="rTableBorder">
						<div class="rTableBody">
							<div class="rTableRow">
								<div class="rTableCell">&spades;&nbsp;<div id="PbnEastSpades"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell">
									<div><span class="red">&hearts;&nbsp;</span><div id="PbnEastHearts"></div></div>
								</div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell">
									<div><span class="red">&diams;&nbsp;</span><div id="PbnEastDiamonds"></div></div>
								</div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell">&clubs;&nbsp;<div id="PbnEastClubs"></div></div>
							</div>
							
							<div class="rTableRow">
								<div class="rTableCell aligntextcenter"><div id="PbnEast" class="blue"></div></div>
							</div>
						</div>
					</div>
					<div class="rTableBorderHidden">
						<div class="rTableBody">
							<div class="rTableRow">
								<div class="rTableCell"><span class = "white">TRICKSPLAYED</span></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell">&nbsp;</div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell"><div id="PbnTrickNumber"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell"><div id="PbntricksNS"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCell"><div id="PbntricksEW"></div></div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="rTableRow">
				<div class="rTableCell aligntextcenter">&nbsp;</div>
			</div>
			<div class="rTableRow">
				<div class="rTableCell aligntextcenter"><div id="PbnHandRecords"></div></div>
				<div class="rTableCell aligntextcenter"><div id="PbnCommentary" class="blue"></div></div>
			</div>
			<div class="rTableRow">
				<div class="rTableCell aligntextcenter"><input type ="button" value="  <  " onClick="Javascript:previousHand();">&nbsp;&nbsp;&nbsp;&nbsp;<input type ="button" value="  >  " onClick="Javascript:nextHand();"></div>
				<div class="rTableCell aligntextcenter"><input type ="button" value="Play" onClick="Javascript:playCard();">&nbsp;<div id="PbnPlayOver" class="blue"></div><input type ="button" value="Reset" onClick="Javascript:resetCards();"></div>
			</div>
		</div>
		</div>
		</div>
	</div>
	</div>
	<div id="box2wrap">
		<div id="box2">
			<div id="box2pad">
	<div class="rTableBorder">
		<div class="rTableBody">
			<div class="rTableRow">	
					<div class="rTableCell">
					<div class="rTable">
						<div class="rTableBody">
							<div class="rTableRow">
								<div class="rTableCellBorder blue minWidthAuction">North</div>
								<div class="rTableCellBorder blue minWidthAuction">East</div>
								<div class="rTableCellBorder blue minWidthAuction">South</div>
								<div class="rTableCellBorder blue minWidthAuction">West</div>
							</div>
							<div class="rTableRow">
								<div class="rTableCellBorder"><div id="PbnBid1"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid2"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid3"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid4"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCellBorder"><div id="PbnBid5"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid6"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid7"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid8"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCellBorder"><div id="PbnBid9"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid10"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid11"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid12"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCellBorder"><div id="PbnBid13"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid14"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid15"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid16"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCellBorder"><div id="PbnBid17"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid18"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid19"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid20"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCellBorder"><div id="PbnBid21"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid22"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid23"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid24"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCellBorder"><div id="PbnBid25"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid26"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid27"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid28"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCellBorder"><div id="PbnBid29"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid30"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid31"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid32"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCellBorder"><div id="PbnBid33"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid34"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid35"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid36"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCellBorder"><div id="PbnBid37"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid38"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid39"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid40"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCellBorder"><div id="PbnBid41"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid42"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid43"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid44"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCellBorder"><div id="PbnBid45"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid46"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid47"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid48"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCellBorder"><div id="PbnBid49"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid50"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid51"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid52"></div></div>
							</div>
							<div class="rTableRow">
								<div class="rTableCellBorder"><div id="PbnBid53"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid54"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid55"></div></div>
								<div class="rTableCellBorder"><div id="PbnBid56"></div></div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="rTableRow">
				<div class="rTableCell aligntextcenter"><input type ="button" value="  <  " onClick="Javascript:decrementAuctionProgressPointer();">&nbsp;&nbsp;&nbsp;&nbsp;<input type ="button" value="  >  " onClick="Javascript:incrementAuctionProgressPointer();"></div>
			</div>
			<div class="rTableRow">
				<div class="rTableCell aligntextcenter"><input type ="button" value="Show" onClick="Javascript:showAuction();">&nbsp;<input type ="button" value="Hide" onClick="Javascript:hideAuction();"></div>
			</div>
		</div>
	</div>
	</div>
		</div>
	</div>

</div>
</div>
</body>
</html>
